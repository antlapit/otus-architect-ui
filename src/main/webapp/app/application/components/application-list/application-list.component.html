<div class="container-fluid">
    <div class="row main-top-padding">
        <div class="col-md-12">
            <otus-architect-application-list-filter></otus-architect-application-list-filter>
        </div>
    </div>
</div>
<otus-architect-center-spinner *ngIf="isLoadingFinApplications"></otus-architect-center-spinner>
<div class="container-fluid">
    <div class="row" *ngIf="!isLoadingFinApplications">
        <div class="col-md-12">
            <table mat-table [dataSource]="dataSource" class="width-percent-100"
                   *ngIf="!!finApplications && finApplications.length > 0; else noFinApplications;">
                <ng-container matColumnDef="number">
                    <th mat-header-cell *matHeaderCellDef>Номер заявки</th>
                    <td mat-cell *matCellDef="let finApplication" align="center" class="limit-width no-border"
                        (click)="goToFinApplication(finApplication.id)">
                        <span class="number-wrapper">{{finApplication.number}}</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="clientName">
                    <th mat-header-cell *matHeaderCellDef>Наименование клиента</th>
                    <td mat-cell *matCellDef="let finApplication" class="no-border"
                        (click)="goToFinApplication(finApplication.id)">
                        <span class="name-wrapper">{{finApplication.clientName}}</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="limit">
                    <th mat-header-cell *matHeaderCellDef>Сумма</th>
                    <td mat-cell *matCellDef="let finApplication" align="right" class="no-border"
                        (click)="goToFinApplication(finApplication.id)">
                        <span class="limit-wrapper">{{finApplication.limit | number:'0.2-2'}} &#8381;</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="commissionSum">
                    <th mat-header-cell *matHeaderCellDef>Комиссия</th>
                    <td mat-cell *matCellDef="let finApplication" align="right" class="no-border"
                        (click)="goToFinApplication(finApplication.id)">
                            <span class="commissionSum-wrapper">{{finApplication.commission | number:'0.2-2'}}
                                &#8381;</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Статус</th>
                    <td mat-cell *matCellDef="let finApplication" align="center" class="stage-width no-border"
                        (click)="goToFinApplication(finApplication.id)">
                                    <span class="stage-name-label" [ngClass]="{
                                        'stage-red': finApplication.stage.error,
                                        'stage-gray': finApplication.stage.final && !finApplication.stage.error && !finApplication.stage.success,
                                        'stage-blue': !finApplication.stage.final,
                                        'stage-green': finApplication.stage.success
                                    }">
                                        {{finApplication.stage?.name}}
                                    </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="author">
                    <th mat-header-cell *matHeaderCellDef>Автор</th>
                    <td mat-cell class="no-border"
                        *matCellDef="let finApplication"
                        (click)="goToFinApplication(finApplication.id)">
                        <p class="author-label">{{finApplication.createdOn | date:'dd.MM.yyy'}}</p>
                        <p class="author-label">{{finApplication.contactName}}</p>
                    </td>
                </ng-container>

                <ng-container matColumnDef="menu">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell class="no-border"
                        *matCellDef="let finApplication">
                        <button mat-icon-button [matMenuTriggerFor]="menu"
                                class="application-actions-menu"
                                aria-label="Доступные действия" *ngIf="anyActionAvailable(finApplication)">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu" overlapTrigger="false">
                            <button mat-menu-item
                                    *ngIf="finApplication.canRevoke"
                                    (click)="revoke(finApplication.id)"
                                    class="otus-architect-menu-button">
                                <span>Отозвать</span>
                            </button>
                        </mat-menu>
                    </td>
                </ng-container>

                <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                    class="pointer no-border application-row"
                    [ngClass]="{'has-changes': row.hasChanges}"></tr>
            </table>
            <ng-template #noFinApplications>
                <p class="no-applications">
                    Нет заявок, удовлетворяющих условиям
                </p>
            </ng-template>
        </div>
    </div>
</div>
